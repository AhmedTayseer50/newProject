<div class="container py-4" dir="rtl">
  <h3 class="mb-3">حالات العملاء (للموظف)</h3>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
  <div *ngIf="loading" class="alert alert-info">جارٍ التحميل…</div>

  <!-- إنشاء Case جديدة -->
  <form [formGroup]="form" (ngSubmit)="createCase()" class="card mb-4">
    <div class="card-body row g-3">
      <!-- اختيار العميل -->
      <div class="col-md-4">
        <label class="form-label">اختر العميل (البريد)</label>
        <select class="form-select" formControlName="userUid">
          <option value="">— اختر —</option>
          <option *ngFor="let u of users" [value]="u.uid">{{ u.email }}</option>
        </select>
      </div>

      <!-- الكورسات (Checkboxes) -->
<div class="col-md-5">
  <label class="form-label d-block">الكورسات</label>

  <div class="course-list">
    <div class="form-check" *ngFor="let c of courses; let i = index">
      <input
        class="form-check-input"
        type="checkbox"
        [formControl]="courseChecks.at(i)"
        [id]="'course_'+i"
      />
      <label class="form-check-label" [for]="'course_'+i">
        {{ c.title || c.id }}
      </label>
    </div>

    <div class="form-text">اختر كورس واحد على الأقل</div>
  </div>
</div>

      <!-- المبلغ -->
      <div class="col-md-3">
        <label class="form-label">المبلغ المدفوع</label>
        <input
          type="number"
          class="form-control"
          formControlName="amount"
          min="0"
          step="1"
        />
      </div>

      <!-- رابط الإثبات (مؤقتًا) -->
      <div class="col-12">
        <label class="form-label">رابط صورة الإثبات (مؤقتًا)</label>
        <input
          class="form-control"
          formControlName="proofUrl"
          placeholder="https://..."
        />
        <div class="form-text">لاحقًا هنفعّل رفع للـ Storage.</div>
      </div>
    </div>

    <div class="card-footer d-flex gap-2">
      <button class="btn btn-primary">حفظ الحالة</button>
    </div>
  </form>

  <!-- قائمتي -->
  <div class="card">
    <div class="table-responsive">
      <table class="table table-sm mb-0">
        <thead class="table-light">
          <tr>
            <th>العميل</th>
            <th>الكورسات</th>
            <th>المبلغ</th>
            <th>الحالة</th>
            <th>التاريخ</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let c of myCases">
            <td>
              {{ c.userEmail }}
              <div class="small text-muted">{{ c.userId }}</div>
            </td>
            <td>
              <span
                class="badge text-bg-secondary me-1"
                *ngFor="let id of c.courseIds | keyvalue"
                >{{ id.key }}</span
              >
            </td>
            <td>{{ c.amount }}</td>
            <td>
              <span
                class="badge"
                [class.text-bg-warning]="c.status === 'onhold'"
                [class.text-bg-success]="c.status === 'processed'"
              >
                {{ c.status }}
              </span>
            </td>
            <td>{{ c.createdAt | date : "short" }}</td>
          </tr>
          <tr *ngIf="!myCases.length">
            <td colspan="5" class="text-center text-muted py-3">
              لا توجد حالات بعد
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
